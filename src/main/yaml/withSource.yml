# result:
#  {0 13, 1 $,  2 $, 3  $,
#   4 $, 5 $,  6 $,  7  $,
#   8 $, 9 $, 10 $, 11 13}

network-model:
  type: ConnectWithinDistance
  parameters: [2.5]

variables:
  seed: &seed
    min: 0
    max: 20
    step: 1
    default: 0
  radius: &leaderRadius
    type: ArbitraryVariable
    parameters: [12.0, [12.0, 15.0, 17.5, 21.5]]
  leaderInitialResource: &leaderInitialResource
    type: ArbitraryVariable
    parameters: [500, [100, 300, 500, 1000]]
  resourceUpperBound: &resourceUpperBound
    type: ArbitraryVariable
    parameters: [200, [50, 200, 300, 500 ]]
  resourceLowerBound: &resourceLowerBound
    type: ArbitraryVariable
    parameters: [10, [10, 20, 50, 100]]
  cloningRatio: &cloningRatio
    type: ArbitraryVariable
    parameters: [500, [100, 300, 500, 1000]]
  deletingRatio: &deletingRatio
    type: ArbitraryVariable
    parameters: [200, [50, 100, 200, 500]]
  layerXY: &layerXY
    type: ArbitraryVariable
    parameters: [10.0, [ 4.0, 10.0, 17,0 ] ]

seeds:
  scenario: *seed
  simulation: *seed

layers:
  - type: BidimensionalGaussianLayer
    parameters: [*layerXY, *layerXY, 40.0, 10.0]
    molecule: successSource

incarnation: collektive

_pool: &program
  - time-distribution: 1
    type: Event
    actions:
      - type: RunCollektiveProgram
        parameters: [it.unibo.collektive.vmc.VMCSourceKt.vmcSource]
  - time-distribution: 1
    type: Event
    actions:
      - type: CloningAction
        parameters: [it.unibo.alchemist.actions.CloningAction]

deployments:
  - type: Rectangle
    parameters: [ 10, 0, 0, 20, 20 ]
    programs:
      - *program
    contents:
      - molecule: leaderRadius
        concentration: *leaderRadius
      - molecule: leaderInitialResource
        concentration: *leaderInitialResource
      - molecule: resourceUpperBound
        concentration: *resourceUpperBound
      - molecule: resourceLowerBound
        concentration: *resourceLowerBound
      - molecule: cloningRatio
        concentration: *cloningRatio
      - molecule: deletingRatio
        concentration: *deletingRatio
      - molecule: leader
        concentration: false
    properties:
      - type: it.unibo.collektive.alchemist.device.sensors.RandomNodeProperty
      - type: it.unibo.collektive.alchemist.device.sensors.LayerProperty

export:
  #  - type: MongoDBExporter
  #    parameters:
  #      uri: mongodb://localhost:27017
  #      dbName: simulation
  #    data:
  #      - time
  #      - molecule: "org:protelis:tutorial:distanceTo"
  #        aggregators: [mean, min, max]
  #        value-filter: onlyfinite
  - type: CSVExporter
    parameters:
      fileNameRoot: convergeCast
      interval: 1
      exportPath: data
    data:
      - time
      - molecule: "it.unibo.collektive.vmc.VMCSourceKt.vmcSource"
        aggregators: [mean, min, max]
        value-filter: onlyfinite
#
#displacements:
#  - in:
#      type: Grid
#      parameters: [0, 0, 3, 2, 1, 1, 0.1, 0.1]
#    programs:
#      - *program